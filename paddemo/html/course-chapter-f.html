<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" type="text/css" href="../css/api.css">
    <link rel="stylesheet" type="text/css" href="../css/font-icon.css">
    <link rel="stylesheet" type="text/css" href="../css/caicui.css">
    <script type="text/javascript" src="../script/api.js"></script>
    <script type="text/javascript" src="../script/zepto.js"></script>
    <title>课程章节</title>
    <style type="text/css">
      .taskList dl{
        padding-left: .5rem;
      }

      .fath{
        display: none;
      }
      .fath.hide-child{
        display: block;
      }
      .count{
        white-space: nowrap;
        display: inline-block;
        float:right;
        padding-right: .3rem;
      }
      .cache-list .list .list .list dl dt p {
          padding-right: 2rem;
      }
      .cache-list > .list > dl dt p {
          padding-right: 2rem;
      }
      .cache-list .list .list > .list dl dt p {
          padding-right: 2rem;
      }
      .cache-list dl.haschild {
          padding-right: .2rem;
      }
      .icon-arrow-right{
        font-size: .4rem;
        line-height: .9rem;
      }
      .cache-list .list {
        background:#fff;
        color: #787878;
    }
      .list.activeTask{
        background: #00a185;
        color:#fff;
      }
      .list.activeTask ul.count li.video:before{
          background: url(../image/video2.png) no-repeat;
        background-size: 100% 100%;
      }
      .list.activeTask ul.count li.live:before{
          background: url(../image/live2.png) no-repeat;
        background-size: 100% 100%;
      }
      .list.activeTask ul.count li.exam:before{
          background: url(../image/task2.png) no-repeat;
        background-size: 100% 100%;
      }

      .cache-list ul.count li{
          position: relative;
          padding-left:0.6rem;
          line-height:0.3rem;
      }
      .cache-list ul.count li.video:before{
        content: "";
        display: inline-block;
        background: url(../image/video.png) no-repeat;
        background-size: 100% 100%;
        width: 0.44rem;
        height: 0.38rem;
        position: absolute;
        left: .1rem;
    }
    .cache-list ul.count li.live:before{
        content: "";
        display: inline-block;
        background: url(../image/live.png) no-repeat;
        background-size: 100% 100%;
        width: 0.38rem;
        height: 0.44rem;
        position: absolute;
        left: .1rem;
    }
    .cache-list ul.count li.exam:before {
        content: "";
        display: inline-block;
        background: url(../image/task.png) no-repeat;
        background-size: 100% 100%;
        width: 0.36rem;
        height: 0.40rem;
        position: absolute;
        left: .2rem;
    }
    .taskVideo{
      display: inline-block;
        background: url(../image/video.png) no-repeat;
        background-size: 100% 100%;
        width: 0.44rem;
        height: 0.38rem;
        margin-left: .6rem;
        margin-top: .05rem;
        vertical-align: middle;
    }
    .taskLive{
      display: inline-block;
        background: url(../image/live.png) no-repeat;
        background-size: 100% 100%;
        width: 0.38rem;
        height: 0.42rem;
        margin-left: .5rem;
        margin-top: .05rem;
        vertical-align: middle;
    }
    .taskExam{
      display: inline-block;
        background: url(../image/task.png) no-repeat;
        background-size: 100% 100%;
        width: 0.36rem;
        height: 0.40rem;
        margin-left: .7rem;
        margin-top: .05rem;
        vertical-align: middle;
    }
    .multiples{
        padding-left: 0.1rem;
      line-height: 0.4rem;
    }
      @font-face {
          font-family: 'icomoon';
          src: url("../fonts/icomoon2.ttf");
          font-weight: normal;
          font-style: normal;
        }
    
    </style>
  </head>
  <body>
    <div style="opacity:.0001; position: absolute; top: 50%;z-index:-1">
      <div id="svgDown" class="down-progress">
        <div class="val">2</div>
      </div>
    </div>
    <div id="content" style="padding-bottom: 1.6rem;"></div>
    <div style="opacity:.0001; position: absolute; top: 50%;z-index:-1">
      <div id="svgDown" class="down-progress"></div>
    </div>
    <script id="tpl" type="text/x-dot-template">
      {{~it.chapters:val:key}}
      {{ if(val.isLeaf=='false'){ }}
      <ul class="cache-list">
        <li class="list">
          <dl>
            <dt tapmode onclick="toggleChild(this)">
              <p style="font-weight:bold;left:0;color:#5a5a5a;">{{=val.chapterTitle}}</p>
            </dt>
          </dl>{{~val.children:val2:key2}}
          {{ if(val2.isLeaf=='false'){ }}
          <ul class="list">
            <dl class="haschild">
              <dt tapmode onclick="toggleCapt(this)"><i class="icon-arrow-down"></i>
                <p>{{=val2.chapterTitle}}</p>
              </dt>
            </dl>{{~val2.children:val3:key3}}
            <li class="list isNowChapter(2, key, key2, key3);">
              <dl class="haschild">
                {{var state=3;}}
                {{var progress=get_dowm('{{=val.chapterId}}','{{=val2.chapterId}}','{{=val3.chapterId}}');}}
                <dt tapmode onclick="toggleTasks(this)"><i type="1" data-chapId="{{=val3.chapterId}}" data-taskslength="{{=val3.tasks.length}}" class="dot-status"></i>
                  <p>{{=val3.chapterTitle}}</p>
                  <ul class="count">{{=countTaskType(key,key2,key3)}}</ul>
                </dt>
                
              </dl>
            </li><div class="fath">
            {{~val3.tasks:val4:key4}}
            {{ if(val4.taskType=='video'){ }}
            <div class="taskList" id="{{=val4.videoCcid}}">
              <dl style="padding-left: .8rem;">          
                <dt tapmode onclick="next(3,'{{=key}}','{{=key2}}','{{=key3}}',this,'{{=val3.chapterId}}')"><i type="1" data-chapId="{{=val3.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskVideo"></span>
                  <p style="padding-left: 1.1rem;width: 82%;">{{=val4.title}}&nbsp;&nbsp;&nbsp;&nbsp;{{=formatSeconds(val4.videoTime)}}</p>                
                </dt>
                <dd>                 
                 <span class="down_speed none"></span>
                  <div id="{{=val3.chapterId}}" courseid="{{=it.courseId}}" chapterida="{{=val.chapterId}}" chapteridb="{{=val2.chapterId}}" chapteridc="{{=val3.chapterId}}" chapterNamea="{{=val.chapterTitle}}" chapterNameb="{{=val2.chapterTitle}}" chapterNamec="{{=val3.chapterTitle}}" courseName="{{=it.courseName}}" versionid="{{=it.versionId}}" type="3" tapmode onclick="down(this)" class="down-progress task{{=val4.videoCcid}}" taskid="{{=val4.taskId}}" apikey="{{=val4.apiKey}}" videositeid="{{=val4.videoSiteId}}"><i class="icon-download3"></i>
                    <div class="val"></div>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='exam'){ }}
            <div class="taskList">
              <dl style="padding-left: .8rem;">
                <dt tapmode onclick="next(3,'{{=key}}','{{=key2}}','{{=key3}}',this,'{{=val3.chapterId}}')"><i type="1" data-chapId="{{=val3.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam"></span>
                  <p style="padding-left: 1.1rem;width: 82%;">{{=val4.title}}</p>                  
                </dt>
                <dd>
                  <div id="" class="" style="padding-right: 0.2rem;">
                    <span>{{=val4.totalCount}}题</span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='knowledgePointExercise'){ }}
            <div class="taskList">
              <dl style="padding-left: .8rem;">
                <dt tapmode onclick="next(3,'{{=key}}','{{=key2}}','{{=key3}}',this,'{{=val3.chapterId}}','{{=val3.knowledgePointId}}')"><i type="1" data-chapId="{{=val3.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam"></span>
                  <p style="padding-left: 0.9rem;top: 0.6rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                  <!--p  {{=progress+'='+val2.chapterId}}-->
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='openCourse'){ }}
            <div class="taskList">
              <dl style="padding-left: .8rem;">
                <dt tapmode onclick="openlive('{{=val4.openCourseLiveManageId}}','{{=val4.openCourseLiveRoomId}}','{{=val4.openCourseLiveRoomPassword}}',this,'{{=val3.chapterTitle}}')"><i type="1" data-chapId="{{=val3.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskLive"></span>
                  <p style="padding-left: 0.9rem;top: 0.6rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                  <!--p  {{=progress+'='+val2.chapterId}}-->
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(changeJson(val4))}}</div>
                </dd>
              </dl>
            </div>
            {{ } }}
            {{~}}</div>
            {{~}}
          </ul>{{ }else{ }}
          <ul class="list active">
            {{var state=3;}}
            {{var progress=get_dowm('{{=val.chapterId}}','{{=val2.chapterId}}','');}}
            <li class="list">
            <dl>
            {{ if(val2.tasks==null){ }}
                <dt tapmode onclick="toggleTasks(this)"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskslength="0" class="dot-status"></i>
                <p>{{=val2.chapterTitle}}</p>
                <ul class="count">{{=countTaskType(key,key2,-1)}}</ul>
              </dt>
            {{ }else{ }}
                <dt tapmode onclick="toggleTasks(this)"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskslength="{{=val2.tasks.length}}" class="dot-status"></i>
                <p>{{=val2.chapterTitle}}</p>
                <ul class="count">{{=countTaskType(key,key2,-1)}}</ul>
              </dt>
            {{ } }}
            </dl>
            </li><div class="fath">
            {{~val2.tasks:val4:key4}}
            {{ if(val4.taskType=='video'){ }}
            <div class="taskList">
              <dl style="padding-left:0.7rem">          
                <dt tapmode onclick="next(2,'{{=key}}','{{=key2}}',-1,this,'{{=val2.chapterId}}')"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskVideo"></span>
                  <p style="padding-left: 1.1rem;width: 82%;">{{=val4.title}}&nbsp;&nbsp;&nbsp;&nbsp;{{=formatSeconds(val4.videoTime)}}</p>                  
                </dt>
                <dd>
                  <span class="down_speed none"></span>                 
                  <div id="{{=val2.chapterId}}" courseid="{{=it.courseId}}" chapterida="{{=val.chapterId}}" chapteridb="{{=val2.chapterId}}" chapteridc="" chapterNamea="{{=val.chapterTitle}}" chapterNameb="{{=val2.chapterTitle}}" chapterNamec="" courseName="{{=it.courseName}}" versionid="{{=it.versionId}}"  type="3" tapmode onclick="down(this)" class="down-progress task{{=val4.videoCcid}}" taskid="{{=val4.taskId}}" apikey="{{=val4.apiKey}}" videositeid="{{=val4.videoSiteId}}"><i class="icon-download3"></i>
                    <div class="val"></div>
                  </div>                  
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='exam'){ }}
            <div class="taskList">
              <dl style="padding-left:0.7rem">
                <dt tapmode onclick="next(2,'{{=key}}','{{=key2}}','{{=key3}}',this,'{{=val2.chapterId}}')"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam"></span>
                  <p style="padding-left: 1.1rem;width: 82%;">{{=val4.title}}</p>                
                </dt>
                <dd>
                  <div id="" class="" style="padding-right: 0.2rem;">
                    <span>{{=val4.totalCount}}题</span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='knowledgePointExercise'){ }}
            <div class="taskList">
              <dl style="padding-left:0.7rem">
                <dt tapmode onclick="next(2,'{{=key}}','{{=key2}}','{{=key3}}',this,'{{=val2.chapterId}}','{{=val2.knowledgePointId}}')"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam"></span>
                  <p style="padding-left: 0.9rem;top: 0.6rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                  <!--p  {{=progress+'='+val2.chapterId}}-->
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='openCourse'){ }}
            <div class="taskList">
              <dl style="padding-left:0.7rem">
                <dt tapmode onclick="openlive('{{=val4.openCourseLiveManageId}}','{{=val4.openCourseLiveRoomId}}','{{=val4.openCourseLiveRoomPassword}}',this,'{{=val2.chapterTitle}}')"><i type="1" data-chapId="{{=val2.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskLive"></span>
                  <p style="padding-left: 0.9rem;top: 0.6rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                  <!--p  {{=progress+'='+val2.chapterId}}-->
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(changeJson(val4))}}</div>
                </dd>
              </dl>
            </div>
            {{ } }}
            {{~}}</div>
          </ul>{{ } }}
          {{~}}
        </li>
      </ul>{{ }else{ }}
      <ul class="cache-list">
        {{var state=3;}}
        {{var progress=get_dowm('{{=val.chapterId}}','','');}}
        <li class="list isNowChapter(0, key, -1, -1);">
          <dl>
            <dt tapmode onclick="toggleTasks(this)"><i type="1" data-chapId="{{=val.chapterId}}" data-taskslength="{{=val.tasks.length}}" class="dot-status"></i>
              <p> {{=val.chapterTitle}}</p>
              <ul class="count">{{=countTaskType(key,-1,-1)}}</ul>
            </dt>
            
          </dl>
        </li><div class="fath">
        {{~val.tasks:val4:key4}}
            {{ if(val4.taskType=='video'){ }}
            <div class="taskList">      
              <dl>
                <dt tapmode onclick="next(1,'{{=key}}',-1,-1,this,'{{=val.chapterId}}')"><i type="1" style="left: 0.3rem;" data-chapId="{{=val.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskVideo" style="margin-left: .6rem;"></span>
                  <p style="padding-left: 1rem;top: 0.65rem;color:#787878;width: 82%;font-size:0.25rem;">{{=val4.title}}&nbsp;&nbsp;&nbsp;&nbsp;{{=formatSeconds(val4.videoTime)}}</p>          
                </dt>
                <dd>
                  <span class="down_speed none" style="top:0.35rem;font-size: 0.26rem;"></span>                  
                  <div id="{{=val.chapterId}}" courseid="{{=it.courseId}}" chapterida="{{=val.chapterId}}" chapteridb="" chapteridc="" chapterNamea="{{=val.chapterTitle}}" chapterNameb="" chapterNamec="" courseName="{{=it.courseName}}" versionid="{{=it.versionId}}"  type="3" tapmode onclick="down(this)" class="down-progress task{{=val4.videoCcid}}" taskid="{{=val4.taskId}}" apikey="{{=val4.apiKey}}" videositeid="{{=val4.videoSiteId}}"><i class="icon-download3"></i>
                    <div class="val"></div>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='exam'){ }}
            <div class="taskList">
              <dl>
                <dt tapmode onclick="next(1,'{{=key}}',-1,-1,this,'{{=val.chapterId}}')"><i type="1" style="left: 0.3rem;" data-chapId="{{=val.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam" style="margin-left: .6rem;"></span>
                  <p  style="padding-left: 1rem;top: 0.65rem;color:#787878;width: 82%;font-size:0.25rem;">{{=val4.title}}</p>
                </dt>
                <dd>
                  <div id="" class="" style="padding-right: 0.2rem;">
                    <span style="color:#787878;font-size:0.24rem;">{{=val4.totalCount}}题</span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='knowledgePointExercise'){ }}
            <div class="taskList">
              <dl>
                <dt tapmode onclick="next(1,'{{=key}}',-1,-1,this,'{{=val.chapterId}}','{{=val.knowledgePointId}}')"><i type="1" style="left: 0.3rem;" data-chapId="{{=val.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskExam" style="margin-left: .6rem;"></span>
                  <p style="padding-left: 1rem;top: 0.56rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(val4)}}</div>
                </dd>
              </dl>
            </div>{{ }else if(val4.taskType=='openCourse'){ }}
            <div class="taskList">
              <dl>
                <dt tapmode onclick="openlive('{{=val4.openCourseLiveManageId}}','{{=val4.openCourseLiveRoomId}}','{{=val4.openCourseLiveRoomPassword}}',this,'{{=val.chapterTitle}}')"><i type="1" style="left: 0.3rem;" data-chapId="{{=val.chapterId}}" data-taskid="{{=val4.taskId}}" class="dot-status"></i><span class="taskLive" style="margin-left: .6rem;"></span>
                  <p style="padding-left: 1rem;top: 0.56rem;color:#787878;width: 82%;">{{=val4.title}}</p>
                </dt>
                <dd>
                  <div id="" class="" style="text-align: center;">
                    <span></span>
                  </div>
                  <div class="down_data none">{{=JSON.stringify(changeJson(val4))}}</div>
                </dd>
              </dl>
            </div>
            {{ } }}
            {{~}}</div>
      </ul>{{ } }}
      {{~}}
    </script>
    <script type="text/javascript" src="../script/jquery.min.js"></script>
    <script type="text/javascript" charset="utf-8">
      function openlive(openCourseLiveManageId,openCourseLiveRoomId,openCourseLiveRoomPassword,obj,chapterTitle){
        clearInterval(getStatusTime);
        var data = $.trim($(obj).next().find(".down_data").html()).replace(/<[^<]*>/g,'');
        var liveinfo = JSON.parse(data);
        
        if(!isEmpty(liveinfo.openCourseCcid) && !isEmpty(liveinfo.openCourseSiteId)){

            judge_task(liveinfo, 0 ,3);

            return false;

        }
        var pageParams = {};
        //需要传递的参数
        var pageParams = {
            from: 'course-studying',
            courseId: course_detail.courseId,//课程id
            //study_progress: res_process,//学习进度
            last_progress: 0,//学习进度
            course_detail: course_detail,//课程详情
            task_info: liveinfo,//当前要学习的任务信息
            type: 'task'
        };
        
        pageParams.data = $.trim($(obj).next().find(".down_data").html());
        pageParams.chapterTitle = chapterTitle;

        

        //跳转到播放页面
        api.openWin({
            name: "course-open",
            url: "course-open.html",
            delay: 200,
            slidBackEnabled: false,//iOS7.0及以上系统中，禁止通过左右滑动返回上一个页面
            pageParam: pageParams
        });        
        
    }

    function changeJson(data){
        if(data){
            data.openCourseContent = stringToEntity(data.openCourseContent);
           return data; 
        }
        
    }

    function stringToEntity(str){
      var newStr = '';
      var arrEntities={'lt':'<','gt':'>','nbsp':' ','amp':'&','quot':'"','#39':"'"};
      newStr = str.replace(/&(lt|gt|nbsp|amp|quot|#39);/ig,function(all,t){return arrEntities[t];});
      return newStr;
    }

      function next(leave, num1, num2, num3,obj,cid,knowledgePointId) {
        // var iframe = $("<iframe width='100%' height='100%'></iframe>");
        // iframe.attr("src","https://view.csslcloud.net/api/view/login?roomid=5F53B9A5D33EAEB19C33DC5901307461&userid=CB735BE8334BC857&autoLogin=true&viewername=ceshi&viewertoken=cmapass18");
        // $("body").html(iframe)
        // return;
          clearInterval(getStatusTime);
          $api.setStorage("setchapterId",cid);
          var downState = $(obj).next().find(".down-progress").attr("type");
          if(pageName == 'course-list') {
              var courseId = $api.getStorage('Course_info').courseId;
      
              //var courseId = api.pageParam.course_id;
              //如果没有缓存信息，就从接口获取
              var tmp_course_detail = $api.getStorage(courseId);
              if (isEmpty(tmp_course_detail)) {
                  //获取课程的详细信息
                  //api/v2.1/course/courseDetail，接口编号：004-006
                  //ajaxRequest('api/v2.1/course/courseDetail', 'get', {
              ajaxRequest('api/teachsource/course/courseDetail', 'get', {  
                      courseId: courseId
                  }, function (ret, err) {//004.006获取课程的详细信息
                      if (err) {
                          api.hideProgress();
                          api.toast({
                              msg: err.msg,
                              location: 'middle'
                          });
                          return false;
                      }
                      if (ret && ret.state == 'success') {
                          if (!ret.data) {
                              api.toast({
                                  msg: '暂无任务',
                                  location: 'middle'
                              });
                              return false;
                          }
                          course_detail = ret.data[0];
                          var tasks = $.trim($(obj).next().find(".down_data").html());
                          //课程详情数据
                          $api.setStorage(courseId, course_detail);
                          var res_process = {
                              'oneChapterIndex': num1,//一级章节索引
                              'twoChapterIndex': (num2 == -1) ? 0 : num2,//二级章节索引
                              'threeChapterIndex': (num3 == -1) ? 0 : num3,//三级章节索引
                              'taskIndex': 0,//任务索引
                              'chapterDeep': leave - 1,//章节层级
                              'progress': 0//任务学习进度
                          };
                          // judge_task(res_process);
                          judge_task(JSON.parse(tasks), 0 ,downState,knowledgePointId);
                      }
                  });
              } else {
                  course_detail = tmp_course_detail;
                  var tasks = $.trim($(obj).next().find(".down_data").html());
                  //存储课程详细信息
                  var res_process = {
                      'oneChapterIndex': num1,//一级章节索引
                      'twoChapterIndex': (num2 == -1) ? 0 : num2,//二级章节索引
                      'threeChapterIndex': (num3 == -1) ? 0 : num3,//三级章节索引
                      'taskIndex': 0,//任务索引
                      'chapterDeep': leave - 1,//章节层级
                      'progress': 0//任务学习进度
                  };
                  //judge_task(res_process);
                   judge_task(JSON.parse(tasks), 0 ,downState,knowledgePointId);
                  //用户上次学习进度数据
              }
          }else{
              changeCharpter(obj, num1, num2, num3);
          }
      }
      
      //统计每个章节的各种任务个数，参数num1表示一级章节，参数num2表示二级章节
      function countTaskType(num1, num2, num3) {
          //if(pageName == 'course-list'){
              //return '';
          //}
          if(num2 == -1) {
              var tmp_chapters = course_detail.chapters[num1].tasks;
          } else if (num3 == -1) {
              var tmp_chapters = course_detail.chapters[num1].children[num2].tasks;
          } else {
              var tmp_chapters = course_detail.chapters[num1].children[num2].children[num3].tasks;
          }
          //得到子章节的任务信息
          var tmp_num = {
              'video': 0,
              'exam': 0,
              'knowledgePointExercise':0,
              'openCourse':0,
              'doc': 0,
              'entry': 0
          };
          for (var i in tmp_chapters) {
              var tmp_tasks = tmp_chapters[i];
              if (tmp_tasks.taskType == 'video') {
                  tmp_num.video++;
              } else if (tmp_tasks.taskType == 'exam') {
                  tmp_num.exam++;
              } else if (tmp_tasks.taskType == 'knowledgePointExercise') {
                  tmp_num.knowledgePointExercise++;
              } else if (tmp_tasks.taskType == 'openCourse') {
                  tmp_num.openCourse++;
              } else if (tmp_tasks.taskType == 'pdfread') {
                  tmp_num.doc++;
              } else if (tmp_tasks.taskType == 'entry') {
                  tmp_num.entry++;
              }
          }
          var tmp_html = '';
          if (tmp_num.video > 0) {
              tmp_html += '<li class="video" style="font-size:.3rem;padding-left: 0.6rem;margin-right: 0.2rem;"><span class="multiples">' + tmp_num.video + '</span></li>';
          }
          if (tmp_num.exam > 0) {
              tmp_html += '<li class="exam" style="padding-left: 0.6rem;margin-right: 0.2rem;"><span class="multiples" style="font-size:.3rem;">' + tmp_num.exam + '</span></li>';
          }
          if (tmp_num.knowledgePointExercise > 0) {
              tmp_html += '<li class="exam"><span class="multiples" style="font-size:.3rem;">' + tmp_num.knowledgePointExercise + '</span></li>';
          }
          if (tmp_num.openCourse > 0) {
              tmp_html += '<li class="live" style="font-size:.3rem;padding-left: 0.6rem;margin-right: 0.2rem;"><span class="multiples">' + tmp_num.openCourse + '</span></li>';
          }
          if (tmp_num.doc > 0) {
              tmp_html += '<li><span class="multiples">' + tmp_num.doc + '</span></li>';
          }
          if (tmp_num.entry > 0) {
              tmp_html += '<li><span class="multiples">' + tmp_num.entry + '</span></li>';
          }
          return tmp_html;
      
      }
      
      //判断是不是当前正在学习的章节
      function isNowChapter(leave, num1, num2, num3){
          return '';
          /*
          if (leave == study_progress.chapterDeep) {
              if (leave >= 0) {
                  if (num1 == study_progress.oneChapterIndex) {
                      if (leave >= 1) {
                          if (num2 == study_progress.twoChapterIndex) {
                              if (leave == 2) {
                                  if (num3 == study_progress.threeChapterIndex) {
                                      alert('ok1');
                                      return 'active';
                                  } else {
                                      alert('ok2');
                                      return '';
                                  }
                              } else {
                                  alert('ok3');
                                  return 'active';
                              }
                          } else {
                              return '';
                          }
                      } else {
                          alert('ok4');
                          return 'active';
                      }
                  } else {
                      return '';
                  }
              } else {
                  return '';
              }
          } else {
              return '';
          }
          */
      }
      
      //点击章节列表中的子章节，切换到相应的任务
      function changeCharpter(obj, num1, num2, num3) {
          //如果新的章节不是当前章节
          if (num1 != tmpOne || num2 != tmpTwo || num3 != tmpThree) {
              //改变背景样式
              $('.list').removeClass('active');
              $(obj).parents('dl').parent().addClass('active');
              if (num2 == -1) {
                  tmpDeep = 0;
              } else if (num3 == -1) {
                  tmpDeep = 1;
              } else {
                  tmpDeep = 2;
              }
              //改变章节数据
              tmpOne = num1;//一级章节索引
              tmpTwo = (num2 == -1) ? 0 : num2;//二级章节索引
              tmpThree = (num3 == -1) ? 0 : num3;//三级章节索引
      
              if (tmpDeep >= 0) {
                  var res = course_detail.chapters[tmpOne];
              }
              if (tmpDeep >= 1) {
                  var res = res.children[tmpTwo];
              }
              if (tmpDeep >= 2) {
                  var res = res.children[tmpThree];
              }
      
              if (isEmpty(res) || isEmpty(res.tasks)) {
                  api.toast({
                      msg: '该章节下还没有学习任务',
                      location: 'middle'
                  });
                  return false;
              }
              chapter_data = res;
      
              //四个导航的添加、移除样式
              $('#NavTask').addClass('vList-selected');
              $('#NavTask').siblings().removeClass('vList-selected');
              now_nav_type = 1;
              //改变任务的内容
              is_over_task = false;
              is_over_extend = false;
              is_over_file = false;
              getChapterTask();
              return false;
          }
      }
      
      //判断任务类型，跳转相应的页面
      function judge_task(task_info, lastProgress,downState,knowledgePointId) {
          if (isEmpty(course_detail) || isEmpty(course_detail.chapters) || isEmpty(task_info)) {
              api.toast({
                  msg: '获取课程信息失败',
                  location: 'middle'
              });
              return false;
          }
      
          //获取章节信息
          // if (res_process.chapterDeep >= 0) {
          //     var chapters_info = course_detail.chapters[res_process.oneChapterIndex];//一级章节信息
          // }
          // if (res_process.chapterDeep >= 1) {
          //     var chapters_info = chapters_info.children[res_process.twoChapterIndex];//二级章节信息
          // }
          // if (res_process.chapterDeep >= 2) {
          //     var chapters_info = chapters_info.children[res_process.threeChapterIndex];//三级章节信息
          // }
      
          // if (isEmpty(chapters_info) || isEmpty(chapters_info.tasks)) {
          //     api.toast({
          //         msg: '暂无任务',
          //         location: 'middle'
          //     });
          //     return false;
          // }
          
          // var task_info = chapters_info.tasks[res_process.taskIndex];//当前任务信息
          // if (isEmpty(task_info)) {
          //     api.toast({
          //         msg: '暂无任务',
          //         location: 'middle'
          //     });
          //     return false;
          // }
          if (isEmpty(task_info)) {
              api.toast({
                  msg: '暂无任务',
                  location: 'middle'
              });
              return false;
          }
          //判断当前任务类型
          if (task_info.taskType == 'video'|| task_info.taskType == 'openCourse') {
              //视频类型
              var new_win_name = 'video';
              var new_win_url = 'video.html';
          } else if (task_info.taskType == 'entry' || task_info.taskType == 'pdfread' || task_info.taskType == 'exam'|| task_info.taskType == 'knowledgePointExercise') {
              //entry（外链类型）、pdfread（pdf类型）、exam（测试题类型）
              var new_win_name = 'course-test';
              var new_win_url = 'course-test.html';
          } else {
              api.toast({
                  msg: '暂无任务，请稍后再试或联系客服',
                  location: 'middle'
              });
              return false;
          }
          //需要传递的参数
          var pageParams = {
              from: 'course-studying',
              courseId: course_detail.courseId,//课程id
              study_progress: lastProgress,//学习进度
              course_detail: course_detail,//课程详情
              task_info: task_info,//当前要学习的任务信息
              type:'task'
          };
          
          if(downState == 4){
              pageParams.isFinish = true;
          }else{
              pageParams.isFinish = false;
          }
          api.hideProgress();

         if(task_info.taskType == 'knowledgePointExercise'){
            if (api.connectionType == 'unknown' || api.connectionType == 'none') {

                api.alert({
                    msg: '网络已断开，请检查网络状态'
                });
                return false;
            }
            ajaxRequest('api/extendapi/examen/get_exercise_point_count_cache', 'post',{knowledge_points:knowledgePointId,type:4}, function (ret, err) {//008.005
                if (err) {
                    api.toast({
                        msg: err.msg,
                        location: 'middle'
                    });
                }
                if (ret && ret.state == 'success') {
                    pageParams.knowledgePointExercise = ret.data[0];
                    //跳转到知识点练习页面
                    api.openWin({
                        name: new_win_name,
                        url: new_win_url,
                        delay: 200,
                        slidBackEnabled: false,//iOS7.0及以上系统中，禁止通过左右滑动返回上一个页面
                        pageParam: pageParams
                    });
                    
                } else {
                    /*api.toast({
                        msg: ret.msg,
                        location: 'middle'
                    });*/
                }
            });
            return false;
        }
          
          //跳转到播放页面
          api.openWin({
              name: new_win_name,
              url: new_win_url,
              delay: 200,
              slidBackEnabled: false,//iOS7.0及以上系统中，禁止通过左右滑动返回上一个页面
              pageParam: pageParams
          });
      }
      
      //判断实心圈、半心圈、空心圈，参数type:'circle'、'progress',参数chap_id二级章节id
      function isSolidcircle(type, chap_id, task_id,course_id,from) {
          //api.alert({msg:api.pageParam});return '';
          var courseId;
          if(isEmpty(course_id)){
              var Course_info=$api.getStorage('Course_info');
               courseId =Course_info.courseId;
          }else{
               courseId = course_id;
          }
          //如果没有缓存信息，就从接口获取
          var tmp_course_detail = $api.getStorage(courseId);
          if (isEmpty(tmp_course_detail)) {
              //获取课程的详细信息
              //api/v2.1/course/courseDetail，接口编号：004-006
              //ajaxRequest('api/v2.1/course/courseDetail', 'get', {
              ajaxRequest('api/teachsource/course/courseDetail', 'get', {  
                  courseId: courseId
              }, function (ret, err) {//004.006获取课程的详细信息
                  if (err) {
                      api.hideProgress();
                      api.toast({
                          msg: err.msg,
                          location: 'middle'
                      });
                      return false;
                  }
                  if (ret && ret.state == 'success') {
                      if (!ret.data) {
                          api.toast({
                              msg: '暂无任务',
                              location: 'middle'
                          });
                          return false;
                      }
                      course_detail = ret.data[0];
                      //课程详情数据
                      $api.setStorage(courseId, course_detail);
                      //处理过的课程进度
                      var arr = {};
                      var data_arr = course_detail.chapters;
                      for (var i in data_arr) {
                          if (data_arr[i].isLeaf == 'false') {
                              var child = data_arr[i].children;
                              for (var j in child) {
                                  if (child[j].isLeaf == 'false') {
                                      var child2 = child[j].children;
                                      for (var k in child2) {
                                          var cId = child2[k].chapterId;
                                          arr[cId] = {};
                                          for (var x in child2[k].tasks) {
                                              if (child[j].isLeaf == 'false') {
      
                                              } else {
                                                  var taskid = child2[k].tasks[x].taskId;
                                                  arr[cId][taskid] = {
                                                      'progress': 0,
                                                      'isok': 0,
                                                      'total': 0
                                                  };
                                              }
                                          }
                                      }
                                  } else {
                                      var cId = child[j].chapterId;
                                      arr[cId] = {};
                                      for (var k in child[j].tasks) {
                                          var taskid = child[j].tasks[k].taskId;
                                          arr[cId][taskid] = {
                                              'progress': 0,
                                              'isok': 0,
                                              'total': 0
                                          };
                                      }
                                  }
                              }
                          } else {
                              var cId = data_arr[i].chapterId;
                              arr[cId] = {};
                              for (var k in data_arr[i].tasks) {
                                  var taskid = data_arr[i].tasks[k].taskId;
                                  arr[cId][taskid] = {
                                      'progress': 0,
                                      'isok': 0,
                                      'total': 0
                                  };
                              }
                          }
                      }
                      //获取课程任务进度列表（new）tested
                      var param = {
                          'token': $api.getStorage('token'), //必须
                          'memberId' : getstor('memberId'),
                          'courseId': courseId, //课程ID,必须
                          'charpterId': '', //章节ID,非必须
                          'taskId': ''//任务ID,非必须
                      };
                      ajaxRequest({ 'origin': 'http://action.caicui.com/', 'pathname': 'api/userAction/course/getTasksProgress/v1.0/' }, 'get', param, function(ret, err) {
                      //ajaxRequest('api/v2/study/getTasksProgress', 'get', param, function (ret, err) {//008.022 获取课程任务进度列表（new）tested，接口编号：008-022
                          if (err) {
                              return false;
                          } else if (ret && ret.state == 'success') {
                              //课程进度
                              for (var i in ret.data) {
                                  var tmpdata = ret.data[i];
                                  if (!isEmpty(arr[tmpdata.chapterId]) && !isEmpty(arr[tmpdata.chapterId][tmpdata.taskId])) {
                                      if (tmpdata.state == 1) {
                                          arr[tmpdata.chapterId][tmpdata.taskId].isok = 3;
                                      } else {
                                          if (tmpdata.progress > 0) {
                                              arr[tmpdata.chapterId][tmpdata.taskId].isok = 1;
                                          } else {
                                              arr[tmpdata.chapterId][tmpdata.taskId].isok = 0;
                                          }
                                      }
      
      
                                      arr[tmpdata.chapterId][tmpdata.taskId].progress = tmpdata.progress;
                                      arr[tmpdata.chapterId][tmpdata.taskId].total = tmpdata.total;
                                  }
                              }
                              //处理过的课程进度
                              if (type == 'circle') {
                                  //获取圈圈样式
                                  if(from == 'video-menu'){
                                      $('#chaList').find('.dot-status').each(function () {
                                          var tmp_chapID = $(this).attr('data-chapId');
      
                                          if (!isEmpty(tmp_chapID) && !isEmpty(arr[tmp_chapID])) {
                                              var num = 0;
                                              var len = 0;
                                              for (var i in arr[tmp_chapID]) {
                                                  num += parseInt(arr[tmp_chapID][i].isok);
                                                  ++len;
                                              }
      
                                              if (num > 0) {
                                                  if (num == len * 3) {
                                                      $(this).attr('type', '3');
                                                      //实心圈
                                                  } else {
                                                      //半圈
                                                      $(this).attr('type', '2');
                                                  }
                                              } else {
                                                  $(this).attr('type', '1');
                                                  //空圈
                                              }
      
                                          }
                                      });
                                  }else {
                                  //     $('#content').find('.dot-status').each(function () {
                                  //         var tmp_chapID = $(this).attr('data-chapId');
                                  //         if (!isEmpty(tmp_chapID) && !isEmpty(arr[tmp_chapID])) {
                                  //             var num = 0;
                                  //             var len = 0;
                                  //             for (var i in arr[tmp_chapID]) {
                                  //                 num += parseInt(arr[tmp_chapID][i].isok);
                                  //                 ++len;
                                  //             }
      
                                  //             if (num > 0) {
                                  //                 if (num == len * 3) {
                                  //                     $(this).attr('type', '3');
                                  //                     //实心圈
                                  //                 } else {
                                  //                     //半圈
                                  //                     $(this).attr('type', '2');
                                  //                 }
                                  //             } else {
                                  //                 $(this).attr('type', '1');
                                  //                 //空圈
                                  //             }
      
                                  //         }
                                  //     });
                                  // }
                                  $('#content').find('.dot-status').each(function (index) {
        var tmp_chapID = $(this).attr('data-chapId');
        
        var tmp_chapProgress,tit;
        if (!isEmpty(tmp_chapID) && !isEmpty(arr[tmp_chapID])) {
            var num = 0;
            var len = 0;
            for (var i in arr[tmp_chapID]) {
                num += parseInt(arr[tmp_chapID][i].isok);
                ++len;
            }
        var chapterProArr = [];
        for (var j=0;j<ret.data.length;j++) {
            if(ret.data[j].chapterId == tmp_chapID){
              chapterProArr.push(ret.data[j])
              // tmp_chapProgress = ret.data[j].progress;
              // tit=ret.data[j].chapterName
            }
          }
        var chapterState = 'no';
        var chapterDoneNum = 0;
        var chapterNoNum = 0;
        var chapterTasksLength = $(this).attr('data-taskslength');
        for(var i=0;i<chapterProArr.length;i++){
          if(chapterProArr[i].state == "1"){
            chapterDoneNum++;
          }else if(chapterProArr[i].state == "0"){
            chapterNoNum++;
          }
        }
        if(chapterDoneNum == chapterTasksLength){
          chapterState = 'end';
        }else if(chapterNoNum || chapterDoneNum){
          chapterState = 'ing';
        }
        switch (chapterState){
            case 'no':
              $(this).attr('type', '1');
              break;
            case 'ing':
              $(this).attr('type', '2');
              break;
            case 'end':
              $(this).attr('type', '3');
              break;
          }
        }
    });                                      
                                      $('.fath').each(function (k,v) {
                                    $(v).find('.dot-status').each(function (key,val) {
                                      var tmp_chapID = $(val).attr('data-chapId');
                                      var tmp_taskID = $(val).attr('data-taskid');
    //                                  alert(tmp_chapID +"===="+ tmp_taskID)
                                      if (!isEmpty(tmp_chapID) && !isEmpty(tmp_taskID)) {
                                          var tmp_task_progress = arr[tmp_chapID][tmp_taskID];
                                          
                                          if (isEmpty(tmp_task_progress) || isEmpty(tmp_task_progress.isok)) {
    //                                          $(this).css('width', '0%');
                            $(val).attr('type', 1);
                                          } else if (tmp_task_progress.isok == 3) {
    //                                          $(this).css('width', '100%');
                            $(val).attr('type', 3);
                                          } else if (tmp_task_progress.isok == 0) {
    //                                          $(this).css('width', '0%');
                            $(val).attr('type', 1);
                                          } else if (tmp_task_progress.isok == 1) {
                                              var tmpwidth = ((tmp_task_progress.progress * 100) / tmp_task_progress.total).toFixed(2) + '%';
    //                                          $(this).css('width', tmpwidth);
                            $(val).attr('type', 2);
                                          }
                                      } else {
    //                                      $(this).css('width', '0%');
                          $(val).attr('type', 1);
                                      }
                                  });
                                  
                                  })
                                      
                                  }
                              } else if (type == 'progress') {
                                  //如果是获取任务进度条
                                  $('#chaTask').find('.taskProgress').each(function () {
                                      var tmp_chapID = chap_id;
                                      var tmp_taskID = $(this).attr('data-taskid');
                                      if (!isEmpty(tmp_chapID) && !isEmpty(tmp_taskID)) {
                                          var tmp_task_progress = arr[tmp_chapID][tmp_taskID];
                                          if (isEmpty(tmp_task_progress) || isEmpty(tmp_task_progress.isok)) {
                                              $(this).css('width', '0%');
                                          } else if (tmp_task_progress.isok == 3) {
                                              $(this).css('width', '100%');
                                          } else if (tmp_task_progress.isok == 0) {
                                              $(this).css('width', '0%');
                                          } else if (tmp_task_progress.isok == 1) {
                                              var tmpwidth = ((tmp_task_progress.progress * 100) / tmp_task_progress.total).toFixed(2) + '%';
                                              $(this).css('width', tmpwidth);
                                          }
                                      } else {
                                          $(this).css('width', '0%');
                                      }
                                  });
                              }
                          }
                      });
      
      
                  }
              });
          } else {
              course_detail = tmp_course_detail;
              //存储课程详细信息
              //处理过的课程进度
              var arr = {};
              var data_arr = course_detail.chapters;
              for (var i in data_arr) {
                  if (data_arr[i].isLeaf == 'false') {
                      var child = data_arr[i].children;
                      for (var j in child) {
                          if (child[j].isLeaf == 'false') {
                              var child2 = child[j].children;
                              for (var k in child2) {
                                  var cId = child2[k].chapterId;
                                  arr[cId] = {};
                                  for (var x in child2[k].tasks) {
                                      //if (child[j].isLeaf == 'false') {
      
                                      //} else {
                                          var taskid = child2[k].tasks[x].taskId;
                                          arr[cId][taskid] = {
                                              'progress': 0,
                                              'isok': 0,
                                              'total': 0
                                          };
                                      //}
                                  }
                              }
                          } else {
                              var cId = child[j].chapterId;
                              arr[cId] = {};
                              for (var k in child[j].tasks) {
                                  var taskid = child[j].tasks[k].taskId;
                                  arr[cId][taskid] = {
                                      'progress': 0,
                                      'isok': 0,
                                      'total': 0
                                  };
                              }
                          }
                      }
                  } else {
                      var cId = data_arr[i].chapterId;
                      arr[cId] = {};
                      for (var k in data_arr[i].tasks) {
                          var taskid = data_arr[i].tasks[k].taskId;
                          arr[cId][taskid] = {
                              'progress': 0,
                              'isok': 0,
                              'total': 0
                          };
                      }
                  }
              }
              //获取课程任务进度列表（new）tested
              var param = {
                  'token': $api.getStorage('token'), //必须
                  'memberId' : getstor('memberId'),
                  'courseId': courseId, //课程ID,必须
                  'charpterId': '', //章节ID,非必须
                  'taskId': ''//任务ID,非必须
              };
              ajaxRequest({ 'origin': 'http://action.caicui.com/', 'pathname': 'api/userAction/course/getTasksProgress/v1.0/' }, 'get', param, function(ret, err) {
              //ajaxRequest('api/v2/study/getTasksProgress', 'get', param, function (ret, err) {//008.022 获取课程任务进度列表（new）tested，接口编号：008-022
                  if (err) {
                      return false;
                  } else if (ret && ret.state == 'success') {
                      //课程进度
                      for (var i in ret.data) {
                          var tmpdata = ret.data[i];
                          if (!isEmpty(arr[tmpdata.chapterId]) && !isEmpty(arr[tmpdata.chapterId][tmpdata.taskId])) {
                              if (tmpdata.state == 1) {
                                  arr[tmpdata.chapterId][tmpdata.taskId].isok = 3;
                              } else {
                                  if (tmpdata.progress > 0) {
                                      arr[tmpdata.chapterId][tmpdata.taskId].isok = 1;
                                  } else {
                                      arr[tmpdata.chapterId][tmpdata.taskId].isok = 0;
                                  }
                              }
      
                              arr[tmpdata.chapterId][tmpdata.taskId].progress = tmpdata.progress;
                              arr[tmpdata.chapterId][tmpdata.taskId].total = tmpdata.total;
                          }
                      }
                      //处理过的课程进度
      
                      if (type == 'circle') {
                          if (from == 'video-menu') {
                              $('#chaList').find('.dot-status').each(function () {
                                  var tmp_chapID = $(this).attr('data-chapId');
                                  if (!isEmpty(tmp_chapID) && !isEmpty(arr[tmp_chapID])) {
                                      var num = 0;
                                      var len = 0;
                                      for (var i in arr[tmp_chapID]) {
                                          num += parseInt(arr[tmp_chapID][i].isok);
                                          ++len;
                                      }
      
                                      if (num > 0) {
                                          if (num == len * 3) {
                                              $(this).attr('type', '3');
                                              //实心圈
                                          } else {
                                              //半圈
                                              $(this).attr('type', '2');
                                          }
                                      } else {
                                          $(this).attr('type', '1');
                                          //空圈
                                      }
      
                                  }
                              });
                          } else {
                              $('#content').find('.dot-status').each(function (index) {
        var tmp_chapID = $(this).attr('data-chapid');

        var tmp_chapProgress,tit;
        if (!isEmpty(tmp_chapID) && !isEmpty(arr[tmp_chapID])) {
            
        var chapterProArr = [];
        for (var j=0;j<ret.data.length;j++) {
            if(ret.data[j].chapterId == tmp_chapID){
              chapterProArr.push(ret.data[j])
              // tmp_chapProgress = ret.data[j].progress;
              // tit=ret.data[j].chapterName
            }
          }
        var chapterState = 'no';
        var chapterDoneNum = 0;
        var chapterNoNum = 0;
        var chapterTasksLength = $(this).attr('data-taskslength');
        for(var i=0;i<chapterProArr.length;i++){
          if(chapterProArr[i].state == "1"){
            chapterDoneNum++;
          }else if(chapterProArr[i].state == "0"){
            chapterNoNum++;
          }
        }
        if(chapterDoneNum == chapterTasksLength){
          chapterState = 'end';
        }else if(chapterNoNum || chapterDoneNum){
          chapterState = 'ing';
        }
        switch (chapterState){
            case 'no':
              $(this).attr('type', '1');
              break;
            case 'ing':
              $(this).attr('type', '2');
              break;
            case 'end':
              $(this).attr('type', '3');
              break;
          }
        }
    });

              $('.fath').each(function (k,v) {
                                $(v).find('.dot-status').each(function (key,val) {
                                  var tmp_chapID = $(val).attr('data-chapId');
                                  var tmp_taskID = $(val).attr('data-taskid');
//                                  alert(tmp_chapID +"===="+ tmp_taskID)
                                  if (!isEmpty(tmp_chapID) && !isEmpty(tmp_taskID)) {
//                                  for (var j=0;j<ret.data.length;j++) {
//                          if(ret.data[j].chapterId == tmp_chapID){
//                            chapterProArr.push(ret.data[j])
//                            // tmp_chapProgress = ret.data[j].progress;
//                            // tit=ret.data[j].chapterName
//                          }
//                        }
                                      var tmp_task_progress = arr[tmp_chapID][tmp_taskID];
                                      
                                      if (isEmpty(tmp_task_progress) || isEmpty(tmp_task_progress.isok)) {
//                                          $(this).css('width', '0%');
                        $(val).attr('type', 1);
                                      } else if (tmp_task_progress.isok == 3) {
//                                          $(this).css('width', '100%');
                        $(val).attr('type', 3);
                                      } else if (tmp_task_progress.isok == 0) {
//                                          $(this).css('width', '0%');
                        $(val).attr('type', 1);
                                      } else if (tmp_task_progress.isok == 1) {
                                          var tmpwidth = ((tmp_task_progress.progress * 100) / tmp_task_progress.total).toFixed(2) + '%';
//                                          $(this).css('width', tmpwidth);
                        $(val).attr('type', 2);
                                      }
                                  } else {
//                                      $(this).css('width', '0%');
                      $(val).attr('type', 1);
                                  }
                              });
                              
                              })
                              
                          }
                      } else if (type == 'progress') {
                          //如果是获取任务进度条
                          $('#chaTask').find('.taskProgress').each(function () {
                              var tmp_chapID = chap_id;
                              var tmp_taskID = $(this).attr('data-taskid');
                              if (!isEmpty(tmp_chapID) && !isEmpty(tmp_taskID)) {
                                  var tmp_task_progress = arr[tmp_chapID][tmp_taskID];
                                  if (isEmpty(tmp_task_progress) || isEmpty(tmp_task_progress.isok)) {
                                      $(this).css('width', '0%');
                                  } else if (tmp_task_progress.isok == 3) {
                                      $(this).css('width', '100%');
                                  } else if (tmp_task_progress.isok == 0) {
                                      $(this).css('width', '0%');
                                  } else if (tmp_task_progress.isok == 1) {
                                      var tmpwidth = ((tmp_task_progress.progress * 100) / tmp_task_progress.total).toFixed(2) + '%';
                                      $(this).css('width', tmpwidth);
                                  }
                              } else {
                                  $(this).css('width', '0%');
                              }
                          });
                      }
                  }
              });
          }
      }
    </script>
    <script type="text/javascript" src="../script/comm.js"></script>
    <script type="text/javascript" src="../script/doT.min.js"></script>
    <script type="text/javascript" src="../script/caicui.js"></script>
    <script type="text/javascript" src="../script/db.js"></script>
    <script type="text/javascript" src="../script/saveTasksProgress.js"></script>
    <script type="text/javascript" src="../script/pagejs/course-list.js"></script>
  </body>
</html>